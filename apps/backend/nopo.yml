name: backend
description: Django application that powers the API.
dockerfile: Dockerfile
static_path: build
infrastructure:
  cpu: "1"
  memory: "512Mi"
  port: 3000
  min_instances: 0
  max_instances: 10
  has_database: true
  run_migrations: true

commands:
  build:
    command: uv sync --frozen --no-install-workspace && vite build && uv run python manage.py collectstatic --noinput --clear
  clean:
    command: rm -rf __pycache__ .ruff_cache node_modules
  fix:
    commands:
      py:
        command: uv tool run ruff format
      js:
        command: eslint --fix
  check:
    commands:
      py:
        command: uv tool run ruff check
      js:
        command: eslint
      types:
        commands:
          py:
            command: uv run mypy .
          js:
            command: tsc --noEmit
  test:
    command: uv run python manage.py test src
  dev:
    commands:
      server:
        command: uv run --verbose python manage.py runserver 0.0.0.0:80 --settings=settings
      vite:
        command: vite --port 5173
  start:
    command: uv run --verbose gunicorn --config gunicorn.conf.py backend.mysite.wsgi:application
  migrate:
    command: uv run --verbose python manage.py migrate
  makemigrations:
    command: uv run --verbose python manage.py makemigrations
  shell:
    command: uv run --verbose python manage.py shell
