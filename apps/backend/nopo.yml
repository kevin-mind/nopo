name: backend
description: Django application that powers the API.
dockerfile: Dockerfile
static_path: build
infrastructure:
  cpu: "1"
  memory: "512Mi"
  port: 3000
  min_instances: 0
  max_instances: 10
  has_database: true
  run_migrations: true

commands:
  build:
    command: uv sync --frozen --no-install-workspace && vite build && uv run python manage.py collectstatic --noinput --clear
  clean:
    command: rm -rf __pycache__ .ruff_cache node_modules
  fix:
    commands:
      lint:
        command: uv tool run ruff format
      lint-js:
        command: eslint --fix
  check:
    commands:
      lint:
        command: uv tool run ruff check
      lint-js:
        command: eslint
      lint-py:
        command: uv tool run ruff check
      types-py:
        command: uv run mypy .
      types-js:
        command: tsc --noEmit
  test:
    command: uv run python manage.py test src
  dev:
    commands:
      runserver:
        command: uv run --verbose python manage.py runserver 0.0.0.0:80 --settings=settings
      vite:
        command: vite --port 5173
  start:
    command: uv run --verbose gunicorn --config gunicorn.conf.py backend.mysite.wsgi:application
  migrate:
    command: uv run --verbose python manage.py migrate
  migrate-check:
    command: uv run --verbose python manage.py migrate --check
  makemigrations:
    command: uv run --verbose python manage.py makemigrations
  shell:
    command: uv run --verbose python manage.py shell
