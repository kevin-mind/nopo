# This file was auto-generated by github-actions-workflow-ts.
# Do not edit directly. Instead, edit the corresponding .wac.ts file in .github/workflows-ts/
# and run `pnpm run gwf:build` to regenerate this file.
name: Services
permissions:
  contents: read
defaults:
  run:
    shell: bash
'on':
  workflow_call:
    inputs:
      filter:
        description: Filter expression passed to nopo list (e.g., "buildable", "changed", "!image")
        required: false
        type: string
        default: ''
      since:
        description: Git ref to compare against for "changed" filter
        required: false
        type: string
        default: origin/main
      ref:
        description: Git ref to checkout (defaults to main)
        required: false
        type: string
        default: ''
    outputs:
      services:
        value: ${{ jobs.discover.outputs.services }}
      services_json:
        value: ${{ jobs.discover.outputs.services_json }}
jobs:
  discover:
    runs-on: ubuntu-latest
    outputs:
      services: ${{ steps.discover.outputs.services }}
      services_json: ${{ steps.discover.outputs.services_json }}
    steps:
      - id: checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}
          fetch-depth: 0
      - id: fetch_main
        name: Fetch origin/main for comparison
        if: ${{ ${{ inputs.since }} == 'origin/main' || ${{ inputs.since }} == '' }}
        run: |-
          # Ensure origin/main is available for comparison
          git fetch origin main:origin/main || true
      - id: setup_node
        uses: ./.github/actions/setup-node
      - id: discover
        name: Discover services
        uses: ./.github/actions-ts/discover-services
        with:
          filter: ${{ inputs.filter }}
          since: ${{ inputs.since }}
