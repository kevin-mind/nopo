name: Claude Approve

on:
  pull_request_review:
    types: [submitted]

permissions:
  contents: read
  pull-requests: write

jobs:
  notify-ready:
    # Only act on approvals from Claude (github-actions[bot])
    if: |
      github.event.review.state == 'approved' &&
      github.event.review.user.login == 'github-actions[bot]'
    runs-on: ubuntu-latest
    steps:
      - name: Add ready-to-merge label
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
        run: |
          # Add the ready-to-merge label
          gh pr edit "$PR_NUMBER" --add-label "ready-to-merge" || true

      - name: Comment on PR
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
        run: |
          gh pr comment "$PR_NUMBER" --body "## Ready for Human Review

          This PR has been:
          - [x] Implemented by Claude automation
          - [x] CI checks passing
          - [x] Reviewed and approved by Claude

          **Awaiting human approval and merge.**

          A human reviewer should:
          1. Review the changes
          2. Approve if satisfied
          3. Merge the PR

          Use \`gh pr merge $PR_NUMBER --merge\` or merge via the GitHub UI."
