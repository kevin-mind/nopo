{
  "name": "ci-failure-recovery",
  "description": "CI fails once, then passes - tests failure recovery with mock Claude",
  "timeout": 600,
  "poll_interval": 10,

  "e2e_outcomes": {
    "ci": ["failure", "success"],
    "release": ["success"],
    "review": ["approved"]
  },

  "states": [
    {
      "name": "01-initial",
      "description": "Issue created, not yet triaged",
      "issue": {
        "state": "open",
        "labels": [],
        "assignees": []
      },
      "project_fields": {
        "Status": "Backlog"
      }
    },
    {
      "name": "02-triaged",
      "description": "After triage completes",
      "issue": {
        "state": "open",
        "labels": ["enhancement", "triaged"]
      },
      "sub_issues": {
        "count": 1,
        "statuses": ["Ready"]
      }
    },
    {
      "name": "03-assigned",
      "description": "nopo-bot assigned, first sub-issue Working",
      "issue": {
        "state": "open",
        "assignees": ["nopo-bot"]
      },
      "sub_issues": {
        "count": 1,
        "statuses": ["Working"]
      },
      "project_fields": {
        "Status": "In Progress"
      }
    },
    {
      "name": "04-iteration-1",
      "description": "After first iteration - PR created",
      "sub_issues": {
        "iterations": [1]
      },
      "branch": {
        "exists": true
      },
      "pull_request": {
        "exists": true,
        "draft": true
      }
    },
    {
      "name": "05-ci-failed",
      "description": "CI failed on first attempt",
      "sub_issues": {
        "failures": [1]
      },
      "pull_request": {
        "exists": true,
        "draft": true
      },
      "project_fields": {
        "Failures": 1
      }
    },
    {
      "name": "06-iteration-2",
      "description": "After fix iteration",
      "sub_issues": {
        "iterations": [2],
        "failures": [0]
      },
      "pull_request": {
        "exists": true,
        "draft": true
      }
    },
    {
      "name": "07-ci-passed",
      "description": "CI passed, failures reset",
      "sub_issues": {
        "failures": [0]
      },
      "pull_request": {
        "exists": true,
        "draft": false
      },
      "project_fields": {
        "Failures": 0
      }
    },
    {
      "name": "08-merged",
      "description": "PR merged, issue closed",
      "issue": {
        "state": "closed"
      },
      "sub_issues": {
        "all_closed": true,
        "statuses": ["Done"]
      },
      "pull_request": {
        "merged": true
      },
      "project_fields": {
        "Status": "Done"
      }
    }
  ],

  "expected": {
    "triage": {
      "labels": ["triaged"],
      "sub_issue_count": 1
    },
    "phases": [
      {
        "branch_pattern": "claude/issue/.*/phase-.*",
        "ci_required": true,
        "review_required": true
      }
    ],
    "completion": {
      "parent_status": "Done",
      "all_sub_issues_closed": true,
      "all_prs_merged": true
    }
  }
}
