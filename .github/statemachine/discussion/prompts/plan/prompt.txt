A user requested a plan for Discussion #{{DISCUSSION_NUMBER}}.

**Discussion title:** {{DISCUSSION_TITLE}}

## Original Discussion Body

{{DISCUSSION_BODY}}

## Previous Agent Notes

{{AGENT_NOTES}}

---

## Your Task

1. Fetch the full discussion content using gh api graphql
2. Search the codebase to understand current architecture
3. Extract actionable items and define issues

```bash
gh api graphql -f query='
  query($number: Int!) {
    repository(owner: "{{REPO_OWNER}}", name: "{{REPO_NAME}}") {
      discussion(number: $number) {
        body
        comments(first: 100) {
          nodes {
            author { login }
            body
            replies(first: 50) {
              nodes {
                author { login }
                body
              }
            }
          }
        }
      }
    }
  }
' -F number={{DISCUSSION_NUMBER}}
```

## Issue Guidelines

Each issue should:
- Have a clear, actionable title
- Include context from the discussion
- Have specific tasks/todos
- Be appropriately sized (prefer smaller issues)

Issue body template:
```markdown
Related to discussion: #{{DISCUSSION_NUMBER}}

## Context
[Context from discussion]

## Tasks
- [ ] Task 1
- [ ] Task 2
```

## E2E Test Mode

**IS_E2E_TEST**: {{IS_E2E_TEST}}

If IS_E2E_TEST is "true", include `test:automation` label on all issues to prevent automatic processing.

## Output

Return structured JSON with:

- **issues**: Array of issues to create, each with:
  - `title`: Issue title
  - `body`: Issue body with context and tasks
  - `labels`: Array of labels (always include `discussion:{{DISCUSSION_NUMBER}}`, add `test:automation` if IS_E2E_TEST)

- **updated_body**: Updated discussion description
  - Preserve original content
  - Add "### Implementation Plan" section with issue references (use placeholders like `#ISSUE_1`, `#ISSUE_2`)

- **summary_comment**: Comment to post after issues are created
  - List created issues with titles
  - Note that assigning nopo-bot will start implementation

- **agent_notes**: Important context for future agents

The executor will:
- Create each issue via gh issue create
- Replace issue placeholders in updated_body with actual numbers
- Update the discussion description
- Post the summary comment
