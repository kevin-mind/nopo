{
  "type": "object",
  "properties": {
    "analysis": {
      "type": "object",
      "description": "Analysis of the pivot request and its impact",
      "properties": {
        "change_summary": {
          "type": "string",
          "description": "Brief summary of what the user wants to change"
        },
        "affects_completed_work": {
          "type": "boolean",
          "description": "Whether this pivot affects checked todos or closed sub-issues"
        },
        "completed_work_details": {
          "type": "array",
          "description": "Details of completed work that would be affected",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["checked_todo", "closed_sub_issue"],
                "description": "Type of completed work"
              },
              "issue_number": {
                "type": "integer",
                "description": "Issue number where this work exists"
              },
              "description": {
                "type": "string",
                "description": "Description of the completed work"
              }
            },
            "required": ["type", "issue_number", "description"]
          }
        }
      },
      "required": ["change_summary", "affects_completed_work"]
    },
    "modifications": {
      "type": "object",
      "description": "Changes to apply to issues",
      "properties": {
        "parent_issue": {
          "type": "object",
          "description": "Modifications to the parent issue",
          "properties": {
            "update_sections": {
              "type": "object",
              "description": "Sections to update (key = section name, value = new content)",
              "additionalProperties": { "type": "string" }
            },
            "add_todos": {
              "type": "array",
              "description": "New unchecked todos to add",
              "items": { "type": "string" }
            },
            "remove_unchecked_todos": {
              "type": "array",
              "description": "Exact text of unchecked todos to remove (CANNOT remove checked todos)",
              "items": { "type": "string" }
            }
          }
        },
        "sub_issues": {
          "type": "array",
          "description": "Modifications to existing sub-issues",
          "items": {
            "type": "object",
            "properties": {
              "issue_number": {
                "type": "integer",
                "description": "Sub-issue number to modify"
              },
              "action": {
                "type": "string",
                "enum": ["modify", "skip"],
                "description": "Whether to modify this sub-issue or skip it"
              },
              "add_todos": {
                "type": "array",
                "description": "New unchecked todos to add",
                "items": { "type": "string" }
              },
              "remove_unchecked_todos": {
                "type": "array",
                "description": "Exact text of unchecked todos to remove",
                "items": { "type": "string" }
              },
              "update_description": {
                "type": "string",
                "description": "New description to add or append"
              }
            },
            "required": ["issue_number", "action"]
          }
        },
        "new_sub_issues": {
          "type": "array",
          "description": "New sub-issues to create (for handling completed work changes)",
          "items": {
            "type": "object",
            "properties": {
              "title": {
                "type": "string",
                "description": "Title for the new sub-issue"
              },
              "description": {
                "type": "string",
                "description": "Full description of the sub-issue"
              },
              "todos": {
                "type": "array",
                "description": "Todo items for the new sub-issue",
                "items": { "type": "string" }
              },
              "reason": {
                "type": "string",
                "enum": ["reversion", "new_scope", "extension"],
                "description": "Why this sub-issue is being created"
              }
            },
            "required": ["title", "description", "todos", "reason"]
          }
        }
      }
    },
    "outcome": {
      "type": "string",
      "enum": ["changes_applied", "needs_clarification", "no_changes_needed"],
      "description": "The result of the pivot analysis"
    },
    "clarification_needed": {
      "type": "string",
      "description": "If outcome is 'needs_clarification', explain what information is needed"
    },
    "summary_for_user": {
      "type": "string",
      "description": "Human-readable summary of what was changed (will be posted as a comment)"
    }
  },
  "required": ["analysis", "outcome", "summary_for_user"]
}
