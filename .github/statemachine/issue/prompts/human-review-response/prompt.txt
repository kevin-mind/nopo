Address human review feedback on PR #{{PR_NUMBER}}

Reviewer: @{{REVIEWER}}
Decision: {{REVIEW_DECISION}}
Branch: `{{HEAD_REF}}`

## Previous Agent Notes

{{AGENT_NOTES}}

---

## Step 1: Read ALL Reviews and Comments

**IMPORTANT**: Read ALL feedback to understand the full context of what's being requested.

```bash
# Get ALL reviews (bodies and decisions) - CRITICAL for understanding ALL feedback
gh pr view {{PR_NUMBER}} --json reviews --jq '.reviews[] | "---\nReviewer: \(.author.login)\nState: \(.state)\nBody:\n\(.body)\n"'

# Get inline comments on code (file-specific feedback) - THESE ARE OFTEN THE MOST IMPORTANT
gh api repos/{{REPO_OWNER}}/{{REPO_NAME}}/pulls/{{PR_NUMBER}}/comments --jq '.[] | "---\nFile: \(.path):\(.line)\nAuthor: \(.user.login)\nComment: \(.body)\n"'

# Get conversation comments (general discussion)
gh pr view {{PR_NUMBER}} --comments
```

**Pay attention to:**
- Review bodies (overall feedback)
- Inline comments on specific code lines (often contain the actual change requests)
- Conversation history (may have follow-up context)

## Step 2: Process Feedback

Human reviewers may have different perspectives than automated reviews. Pay special attention to:
- Architectural concerns
- Maintainability feedback
- Domain knowledge insights
- User experience considerations

**For each comment:**

- **Change request**: Make the fix, commit
- **Question**: Prepare a response; make change if implied
- **Concern**: Address the concern or explain the trade-off

## Step 3: Commit and Push (if changes made)

```bash
git push origin {{HEAD_REF}}
```

Push converts PR to draft and triggers CI. CI-pass marks it ready.

## Rules

- Address ALL feedback from human reviewer
- Atomic commits for each change
- Follow CLAUDE.md guidelines
- Be respectful of human insights - they often catch things automation misses

## Output

Return structured JSON with:

- **had_commits**: true if you made commits, false if discussion only

- **summary**: Comment to post on the PR explaining:
  - What changes were made (if any)
  - Responses to questions/discussion
  - Any concerns or clarifications

- **commits**: Array of commit SHAs created

- **agent_notes**: Important context for future agents

The executor will:
- Post the summary as a PR comment
- If had_commits=false, re-request review from the reviewer
- If had_commits=true, CI will trigger and handle PR state
