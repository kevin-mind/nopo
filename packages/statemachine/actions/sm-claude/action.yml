name: 'Claude Code'
description: 'Run Claude Code via the Agent SDK with real-time streaming output'

inputs:
  prompt:
    description: 'Direct prompt text to send to Claude'
    required: false
  prompt_dir:
    description: 'Directory name containing prompt.txt and optional outputs.json'
    required: false
  prompts_base:
    description: 'Base directory for prompts (default: .github/statemachine/issue/prompts)'
    required: false
    default: '.github/statemachine/issue/prompts'
  prompt_file:
    description: 'Path to a prompt file (legacy - prefer prompt_dir)'
    required: false
  prompt_vars:
    description: 'JSON object of variables to substitute in the prompt (replaces {{VAR_NAME}})'
    required: false
    default: '{}'
  working_directory:
    description: 'Working directory for Claude to operate in'
    required: false
  allowed_tools:
    description: 'Comma-separated list of tools Claude can use (e.g., "Read,Write,Edit,Bash")'
    required: false
  mock_output:
    description: 'JSON for test mode - returns immediately with this as structured output'
    required: false
  github_token:
    description: 'GitHub token for fetching issue content (body/comments). Required if issue_number is set.'
    required: false
  issue_number:
    description: 'Issue number to fetch body and comments from. Will inject ISSUE_BODY and ISSUE_COMMENTS into prompt_vars.'
    required: false
  agent_notes:
    description: 'Agent notes to inject as AGENT_NOTES prompt variable'
    required: false

outputs:
  success:
    description: 'Whether execution succeeded (true/false)'
  output:
    description: 'Raw text output from Claude'
  structured_output:
    description: 'JSON structured output if outputs.json schema was provided'
  error:
    description: 'Error message if execution failed'
  num_turns:
    description: 'Number of API round-trips'
  cost_usd:
    description: 'Total cost in USD'

runs:
  using: node20
  main: dist/index.cjs
